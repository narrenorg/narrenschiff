---
- name: Init helm
  helm:
    command: init
    opts:
      - tiller-tls
      - tiller-tls-verify
    args:
      tiller-tls-cert: certs/tiller.cert.pem
      tiller-tls-key: certs/tiller.key.pem
      tls-ca-cert: certs/ca.cert.pem
      service-account: tiller
      tiller-namespace: kube-system

- name: Update repo
  helm:
    command: repo update

- name: Install a chart
  helm:
    command: install
    chart: charts/pypiserver
    opts:
      - tls
      - atomic
    args:
      tls-ca-cert: "{{ tls_ca_pem }}"
      tls-ca-cert: "certs/ca.cert.pem"
      tls-cert: "certs/helm.cert.pem"
      tls-key: "certs/helm.key.pem"
      version: "0.1.0"
      namespace: "development"
      name: "pypiserver"
      set:
        - "secret.htpasswd='admin:1ce4cee4e1a24b9b9babb8e01f9752ae'"
        - "common.storage='5'"
